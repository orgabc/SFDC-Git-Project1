<apex:page docType="html-5.0" sidebar="false" controller="dupcheck.dc3ControllerBatch" title="Batch - Duplicate Check for Salesforce" action="{!janitor}" tabstyle="dcBatch__tab">



	<apex:stylesheet value="{!URLFOR($Resource.dupcheck__dc3Assets,'/dc3/assets/css/bootstrap-namespaced.min.css')}" />
	<apex:stylesheet value="{!URLFOR($Resource.dupcheck__dc3Assets,'/dc3/assets/css/fonts.css')}" />
	<apex:stylesheet value="{!AssetsUrlStatic}/css/bootstrap-select.css" />
	<apex:stylesheet value="{!AssetsUrlStatic}/css/bootstrap-slider.css" />
	<apex:stylesheet value="{!AssetsUrl}/assets/css/duplicatecheck.css" />

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]--> 

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<apex:includeScript value="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" />
	<apex:includeScript value="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" />
	<apex:includeScript value="//ajax.googleapis.com/ajax/libs/angularjs/1.3.11/angular.min.js" />
	<apex:includeScript value="//ajax.googleapis.com/ajax/libs/angularjs/1.3.11/angular-sanitize.min.js" />
	<apex:includeScript value="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.0/ui-bootstrap.js" />
	<apex:includeScript value="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.0/ui-bootstrap-tpls.js" />
	<apex:includeScript value="{!AssetsUrlStatic}/javascript/bootstrap-modal.js" />
	
	<apex:includeScript value="{!AssetsUrlStatic}/javascript/bootbox.min.js" />
	<apex:includeScript value="{!AssetsUrlStatic}/javascript/bootstrap-select.js" />
	<apex:includeScript value="{!AssetsUrlStatic}/javascript/bootstrap-slider.js" />
	<apex:includeScript value="{!AssetsUrl}/assets/javascript/duplicatecheck.js" />
	<apex:includeScript value="{!AssetsUrl}/assets/javascript/duplicatecheck.batch.js" />

	<apex:includeScript value="../../soap/ajax/31.0/connection.js" />

	<div class="bootstrap-sf1" ng-app="batchApp" data-sf-action-abort="{!$RemoteAction.dc3ControllerBatch.abortJob}" data-sf-related-object="{!$RemoteAction.dc3ControllerBatch.getRelatedTypeAhead}" data-sf-action-merge="{!$RemoteAction.dc3ControllerBatch.quickMerge}" data-sf-action-convert="{!$RemoteAction.dc3ControllerBatch.quickConvert}" data-sf-action-delete="{!$RemoteAction.dc3ControllerBatch.deleteBatch}" data-sf-job-list="{!$RemoteAction.dc3ControllerBatch.getJobListByPage}" data-sf-action="{!$RemoteAction.dc3ControllerBatch.getJobListByPage}" data-sf-action-delta="{!$RemoteAction.dc3ControllerBatch.startDelta}">
		<div class="container-fluid" ng-init="convertStatus='{!convertStatusDefault}'; convertOwner='LEAD';">

			<div class="tab-content">
				<div id="overview" class="tab-pane active" role="tabpanel">

					<div class="row mg-b-10">
						<div class="col-xs-12">
							<div class="pull-left tools">
								<h2 class="panel-title">
									<i class="s1icon s1icon-c-95"></i> Job Overview
								</h2>
							</div>
							<div class="pull-right tools">
								<a href="#" onClick="dcNavigate('http://ity.vc/app-job', '')" class="help">Help <i class="s1utility s1utility-help "></i></a>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-xs-12" ng-controller="templateController">
							<div ng-include="$root.view"/>	
						</div>
					</div>

				</div>
			</div>


		</div>

		<script type="text/ng-template" id="schedule" data-sf-scheduled-list="{!$RemoteAction.dc3ControllerBatch.getScheduledListByPage}">
								<div class="card-list" ng-controller="scheduleController" ng-init="endpoint.deleteScheduledJob='{!$RemoteAction.dc3ControllerBatch.deleteScheduledJob}';endpoint.deactivateScheduledJob='{!$RemoteAction.dc3ControllerBatch.deactivateScheduledJob}';endpoint.activateScheduledJob='{!$RemoteAction.dc3ControllerBatch.activateScheduledJob}';endpoint.startScheduledJob='{!$RemoteAction.dc3ControllerBatch.startScheduledJob}'">
									<div class="card-list-heading">
										<div class="row">
											<div class="col-xs-6 text-left">
												<button href="#" class="btn btn-success" ng-if="{!license.features.batchDeduplication}" ng-click="openNewJob()">Add new job</button>
											</div>
											<div class="col-xs-6 text-right" ng-if="{!license.features.batchSchedule}">
												<button class="btn btn-info" ng-show="$root.view=='schedule'" ng-click="$root.view='process'">Processed Jobs</button>
												<button class="btn btn-info" ng-show="$root.view=='process'" ng-click="$root.view='schedule'">Scheduled Jobs</button>
											</div>
										</div>


										<br /> <br />
										<table class="table" id="batches">
											<thead>
												<tr>
													<th>Name</th>
													<th class="col-xs-1">Object</th>
													<th width="35">&nbsp;</th>
													<th width="35">&nbsp;</th>
													<th class="col-xs-1">Status</th>
													<th class="col-xs-2">Next start</th>
													<th class="col-xs-3">&nbsp;</th>
												</tr>
											</thead>
										</table>

									</div>
									<div class="card" ng-repeat="(id, job) in scheduleList"> 
										<div class="card-heading">

											<table class="table table-hover" id="batches">
												<tbody>
													<tr data-status="{{job.status}}" id="{{job.jobId}}">
														<td class="jobName" ng-bind-html="job.jobName"></td>
														<td class="col-xs-1" ng-bind-html="job.displayObjectName"></td>
														<td width="35"><i class="s1utility s1utility-filter" popover="{{job.filter}}" popover-trigger="mouseenter" ng-if="job.filter" /></td>
														<td width="35"> 
															<i class="s1utility s1utility-refresh" popover="Auto Merge where score is equal or higher then {{job.autoProcessThreshold}}%" popover-trigger="mouseenter" ng-if="job.autoProcessType == 'MERGE'"/>
															<i class="s1utility s1utility-refresh" popover="Auto Convert where score is equal or higher then {{job.autoProcessThreshold}}% || Status = {{job.autoProcessConvertStatus}} || Convert Owner = {{job.autoProcessConvertOwner}}" popover-trigger="mouseenter" ng-if="job.autoProcessType == 'CONVERT'"/>
														</td>
														<td class="col-xs-1" >
															<i class="s1utility s1utility-check text-success" ng-if="job.status=='Active'"/>
															<i class="s1utility s1utility-close text-danger" ng-if="job.status=='Inactive'"/>
															&nbsp;<span ng-bind-html="job.statusLabel"/>			
														</td>
														<td class="col-xs-2" ng-bind-html="job.nextDateFormat"></td>
														<td class="col-xs-3 text-right">
															<i class="s1utility s1utility-spinner s1utility-animate" ng-if="process[job.jobId]"/>
															<button class="btn btn-xs btn-primary" ng-click="startScheduledJob(job.jobId)" ng-disabled="process[job.jobId]">
																
																Start Now
															</button>
															<button class="btn btn-xs btn-success" ng-click="activateScheduledJob(job.jobId)" ng-if="job.status=='Inactive'" ng-disabled="process[job.jobId]">
																
																Activate
															</button>
															<button class="btn btn-xs btn-warning" ng-click="deactivateScheduledJob(job.jobId)" ng-if="job.status=='Active'" ng-disabled="process[job.jobId]">
																
																De-Activate
															</button>
															<button class="btn btn-xs btn-danger" ng-click="deleteScheduledJob(job.jobId)" ng-disabled="process[job.jobId]">
																
																Delete
															</button>
														</td>
													</tr>
												</tbody>
											</table>

										</div>
										
									</div>
									<div class="card-footer">
										<div class="row">
											<div class="col-xs-12 text-center">
												<pagination total-items="totalItemsSchedule" ng-model="scheduleListPage" max-size="5" class="pagination-sm" ng-change="getScheduleJobList()" boundary-links="true"></pagination>


											</div>
										</div>
										<div class="clearfix"></div>
									</div>
								</div>
		
	    </script>
		<script type="text/ng-template" id="process">
							<div class="card-list" ng-controller="jobController">
								<div class="card-list-heading">
									<div class="row">
										<div class="col-xs-6 text-left">
											<button class="btn delete-all" ng-model="removeAllButton" ng-disabled="checkCount < 1" ng-click="removeJobs($event)">Delete selected</button>
											<button href="#" class="btn btn-success" ng-if="{!license.features.batchDeduplication}" ng-click="openNewJob()">Add new job</button>
											<apex:outputPanel layout="none" rendered="{!isDelta}">
												<button class="btn btn-primary delta" ng-click="uniqueUploadJob($event)">Unique Import</button>
											</apex:outputPanel>
											<i class="s1utility s1utility-spinner s1utility-animate" ng-if="pageRefresh"/>
										</div>
										<div class="col-xs-6 text-right" ng-if="{!license.features.batchSchedule}">
											<button class="btn btn-info" ng-show="$root.view=='schedule'" ng-click="$root.view='process'">Processed Jobs</button>
											<button class="btn btn-info" ng-show="$root.view=='process'" ng-click="$root.view='schedule'">Scheduled Jobs</button>
										</div>
									</div>


									<br /> <br />
									<table class="table" id="batches">
										<thead>
											<tr>
												<th width="35"><input type="checkbox" class="all" ng-checked="allChecked()" ng-click="checkAll()" /></th>
												<th>Name</th>
												<th class="col-xs-1">Object</th>
												<th width="35">&nbsp;</th>
												<th class="col-xs-1">Started</th>
												<th class="col-xs-1">Progress</th>
												<th class="col-xs-1">Finished</th>
												<th class="col-xs-1 text-center">Groups</th>
												<th class="col-xs-1 text-center">Duplicate</th>
												<th class="col-xs-1 text-center">Average Score</th>
												<th class="col-xs-3">&nbsp;</th>
											</tr>
										</thead>
									</table>

								</div>
								<div class="card" ng-repeat="(id, job) in jobList">
									<div class="card-heading">

										<table class="table table-hover" id="batches">
											<tbody>
												<tr data-status="{{job.status}}" id="{{job.jobId}}">
													<td width="35" class="cb"><input type="checkbox" class="record" value="{{job.jobId}}" ng-change="select(job.jobId)" ng-model="selected[job.jobId]" /></td>
													<td class="jobName" ng-bind-html="job.jobName"></td>
													<td class="displayObjectName col-xs-1" ng-bind-html="job.displayObjectName"></td>
													<td width="35">
														<i class="s1utility s1utility-filter" popover="{{job.filter}}" popover-trigger="mouseenter" ng-if="job.filter" />
														<i class="s1utility s1utility-refresh" popover="Auto Merge where score is equal or higher then {{job.autoProcessThreshold}}%" popover-trigger="mouseenter" ng-if="job.autoProcessType == 'MERGE'"/>
														<i class="s1utility s1utility-refresh" popover="Auto Convert where score is equal or higher then {{job.autoProcessThreshold}}% || Status = {{job.autoProcessConvertStatus}} || Convert Owner = {{job.autoProcessConvertOwner}}" popover-trigger="mouseenter" ng-if="job.autoProcessType == 'CONVERT'"/>
												
													</td>
													<td class="col-xs-1 startDateFormat">{{job.startDateFormat}}</td>
													<td class="col-xs-1"><progressbar ng-if="job.status == 'Processing'" value="job.progress" max="100" class="progress-striped active">{{job.status}}</progressbar> <progressbar ng-if="job.status == 'Aborted'" value="100" max="100" type="warning">{{job.status}}</progressbar> <progressbar ng-if="job.status == 'Holding'" value="100" max="100" type="info">{{job.status}}</progressbar> <progressbar ng-if="job.status == 'Queued'" value="100" max="100" type="info" class="progress-striped active">{{job.status}}</progressbar> <progressbar ng-if="job.status == 'Preparing'" value="0" max="100" type="info" class="progress-striped active">{{job.status}}</progressbar> <progressbar ng-if="job.status == 'Completed'" value="100" max="100" type="success">{{job.status}}</progressbar> <progressbar ng-if="job.status == 'Failed'" value="100" max="100" type="danger">{{job.status}}</progressbar></td>
													<td class="col-xs-1 until">{{job.endDateFormat}}</td>
 
													<td class="col-xs-1 text-center groupCount">{{job.groupCount}}</td>
													<td class="col-xs-1 text-center duplicateCount">{{job.duplicateCount}}</td>
													<td class="col-xs-1 text-center averageScore">{{job.averageScore}}</td>
													<td class="col-xs-3 text-right actions">
														<a href="#" class="btn btn-xs btn-warning open" ng-click="openUrl('{!URLFOR($Page.dc3BatchDetail, null)}','Id=' + job.jobId)" ng-show="{{job.groupCount > 0}}">Open</a> 
														<a href="#" class="btn btn-xs btn-info export" ng-click="openUrlNew('{!URLFOR($Page.dc3BatchExport, null)}','Id=' + job.jobId)" ng-show="{{job.groupCount > 0}}" ng-if="{!license.features.batchExport}">Export</a> 
														<a href="#" class="btn btn-xs btn-success merge" data-toggle="modal" data-job-id="{{job.jobId}}" data-low-score="{{job.lowScore}}" data-target="#merge" ng-show="{{job.status == 'Completed' && job.groupCount > 0 && job.isMerge}}" ng-if="{!license.features.batchMerge}">Auto Merge</a> 
														<a href="#" class="btn btn-xs btn-success convert" data-toggle="modal" data-job-id="{{job.jobId}}" data-low-score="{{job.lowScore}}" data-target="#convert" ng-show="{{job.status == 'Completed' && job.groupCount > 0 && job.isConvert}}" ng-if="{!license.features.batchConvert}">Auto Convert</a> 
														<a href="#" class="btn btn-xs btn-primary abort" ng-click="abortJob(job, $event)" ng-show="{{job.status == 'Processing' || job.status == 'Holding' || job.status == 'Queued' || job.status == 'Preparing'}}">Abort</a> 
														<a href="#" class="btn btn-xs btn-danger delete" ng-click="removeJob(job, $event, $index)" ng-show="{{job.status == 'Completed' || job.status == 'Aborted' || job.status == 'Failed'}}">Delete</a></td>
												</tr>
											</tbody>
										</table>

									</div>
									<div class="card-detail" ng-if="job.childJobs.length > 0">
										<table class="table">
											<tbody>
												<tr ng-repeat="child in job.childJobs">
													<td width="35">&nbsp;</td>
													<td colspan="2">{{child.jobName}}</td>

													<td class="col-xs-1 startDateFormat">{{child.startDateFormat}}</td>
													<td class="col-xs-1"><progressbar ng-if="child.status == 'Processing'" value="child.progress" max="100" class="progress-striped active">{{child.status}}</progressbar> <progressbar ng-if="child.status == 'Aborted'" value="100" max="100" type="warning">{{child.status}}</progressbar> <progressbar ng-if="child.status == 'Holding'" value="100" max="100" type="info">{{child.status}}</progressbar> <progressbar ng-if="child.status == 'Queued'" value="100" max="100" type="info" class="progress-striped active">{{child.status}}</progressbar> <progressbar ng-if="child.status == 'Preparing'" value="0" max="100" type="grey" class="progress-striped active">{{child.status}}</progressbar> <progressbar ng-if="child.status == 'Completed'" value="100" max="100" type="success">{{child.status}}</progressbar> <progressbar ng-if="child.status == 'Failed'" value="100" max="100" type="danger">{{child.status}}</progressbar></td>
													<td class="col-xs-1 until">{{child.endDateFormat}}</td>

													<td class="col-xs-1 text-center groupCount"></td>
													<td class="col-xs-1 text-center duplicateCount"></td>
													<td class="col-xs-1 text-center averageScore"></td>
													<td class="col-xs-3 text-right actions"><a href="" class="btn btn-xs btn-primary abort" ng-click="abortJob(child, $event)" ng-show="{{child.status == 'Processing' || child.status == 'Holding' || child.status == 'Queued' || child.status == 'Preparing'}}">Abort</a></td>
												</tr>
											</tbody>
										</table>

									</div>
								</div>
								<div class="card-footer">
									<div class="row">
										<div class="col-xs-12 text-center">
											<pagination total-items="totalItem" ng-model="jobListPage" max-size="5" class="pagination-sm" ng-change="changePage()" boundary-links="true"></pagination>
										</div>
									</div>
									<div class="clearfix"></div>
								</div>

								<div class="modal fade" id="merge" tabindex="-1" role="dialog" aria-labelledby="Start Merge" aria-hidden="true" >
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal">
													<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
												</button>
												<h3 class="modal-title">Start an Auto Merge</h3>
											</div>
											<div class="modal-body">
												<div class="row">
													<div class="col-xs-6">
														<p class="bold">Job</p>
													</div>
													<div class="col-xs-6">
														<p>{{mergeJob}}</p>
													</div>
												</div>
												<div class="row">
													<div class="col-xs-6">
														<p class="bold">Threshold</p>
													</div>
													<div class="col-xs-6">
														<select selectpicker="selectpicker" selectpicker-option="mergeScoreList" ng-options="score for score in mergeScoreList" id="mergeScore" ng-model="mergeScore">

														</select>
													</div>
												</div>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
												<button type="button" class="btn btn-primary" ng-click="startMerge($event)">Start Merge</button>
											</div>
										</div>
									</div>
								</div>
								<div class="modal fade" id="convert" tabindex="-1" role="dialog" aria-labelledby="Start Convert" aria-hidden="true" >
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal">
													<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
												</button>
												<h3 class="modal-title">Start an Auto Convert</h3>
											</div>
											<div class="modal-body">
												<div class="row mg-b-10">
													<div class="col-xs-6">
														<p class="bold">Job</p>
													</div>
													<div class="col-xs-6">
														<p>{{convertJob}}</p>
													</div>
												</div>

												<div class="row mg-b-10">
													<div class="col-xs-6">
														<p class="bold">Threshold</p>
													</div>
													<div class="col-xs-6">
														<select selectpicker="selectpicker" class="form-control" selectpicker-option="convertScoreList" ng-options="score for score in convertScoreList" id="convertScore" ng-model="convertScore">

														</select>
													</div>
												</div>

												<div class="row mg-b-10">
													<div class="col-xs-6">
														<p class="bold">Convert Status</p>
													</div>
													<div class="col-xs-6">
														<select selectpicker="selectpicker" id="convertStatus" ng-model="convertStatus" class="form-control">
															<apex:repeat value="{!convertStatus}" var="stat">
																<option data-content="{!JSINHTMLENCODE(stat.Label)}" value="{!stat.Value}">{!JSINHTMLENCODE(stat.Label)}</option>
															</apex:repeat>
														</select>
													</div>
												</div>
												<div class="row mg-b-10">
													<div class="col-xs-6">
														<p class="bold">Owner for new records</p>
													</div>
													<div class="col-xs-6">
														<select selectpicker="selectpicker" id="convertOwner" ng-model="convertOwner" class="form-control">
															<option data-content="Current {!$ObjectType.Lead.Label} Owner" value="LEAD">Current {!$ObjectType.Lead.Label} Owner</option>
															<option data-content="Current {!$ObjectType.Contact.Label} Owner" value="CONTACT">Current {!$ObjectType.Contact.Label} Owner</option>
															<option data-content="Current {!$ObjectType.Account.Label} Owner" value="ACCOUNT">Current {!$ObjectType.Account.Label} Owner</option>
															<option data-content="{!$User.FirstName} {!$User.LastName}" value="{!$User.Id}">{!$User.FirstName} {!$User.LastName}</option>
															<option data-content="Other: Specify.." value="OTHER">Other: Specify..</option>
														</select>
													</div>
												</div>
												<div class="row mg-b-10" ng-if="convertOwner=='OTHER'">
													<div class="col-xs-6">
														<p class="bold"></p>
													</div>
													<div class="col-xs-6">
														<input placeholder="type name.." class="form-control" typeahead-loading="loadingLocations" typeahead-wait-ms="500" typeahead-min-length="3" ng-model="convertOwnerName" typeahead-on-select="convertOwnerId = $item.id" typeahead="related.name for related in getLookup($viewValue, 'User')" type="text" /> <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i>
													</div>
												</div>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
												<button type="button" class="btn btn-primary" ng-click="startConvert($event)">Start Convert</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						
		</script>
		
		<script type="text/ng-template" id="modalStartJob" data-sf-filter-field="{!$RemoteAction.dc3ControllerBatch.getFilterFieldList}" data-sf-action="{!$RemoteAction.dc3ControllerBatch.startBatchSearch}" data-sf-scenario="{!$RemoteAction.dc3ControllerBatch.getScenarioList}" data-sf-cross-object="{!$RemoteAction.dc3ControllerBatch.getCrossObjectList}">
        <div class="modal-header">
			<button type="button" class="close" ng-click="cancel()">
				<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
			</button>
            <h3 class="modal-title">Start a new job</h3>
        </div>
        <div class="modal-body">
            <div class="row">
							<div class="col-xs-12">
								<p class="bold">Select object</p>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-12">
								<select selectpicker="selectpicker" data-width="100%" ng-model="sourceObject" ng-change="objectSelect()">
									<option data-content="Please select" value=""></option>
									<apex:repeat value="{!ObjectList}" var="config">
										<option data-content="<span><i class='s1icon {!JSINHTMLENCODE(ObjectMeta[config].icon)}'></i> {!JSINHTMLENCODE(ObjectMeta[config].Label)} </span>" value="{!JSINHTMLENCODE(ObjectMeta[config].Prefix)}"></option>
									</apex:repeat>
								</select>
							</div>

						</div>
						<div ng-hide="crossObjectList == null">

							<div class="row cross-add-object ">
								<div class="col-xs-12">
									<p>&nbsp;</p>
								</div>
							</div>
							<div class="row cross-add-object ">
								<div class="col-xs-12">
									<p class="bold">Match with</p>
								</div>
							</div>
							<div class="row cross-add-object ">
								<div class="col-xs-12">
									<select data-width="100%" ng-change="crossObjectSelect()" selectpicker="selectpicker" selectpicker-option="crossObjectList" id="crossobject" ng-options="c.Prefix as c.Label for c in crossObjectList" ng-model="crossObject">
										<option data-content="Please select" value=""></option>
									</select>
								</div>

							</div>
						</div>
						<div class="row batch-scenario">
							<div class="col-xs-12">
								<p>&nbsp;</p>
							</div>
						</div>
						<div class="row batch-scenario">
							<div class="col-xs-12">
								<p class="bold">Scenario</p>
							</div>
						</div>
						<div class="row batch-scenario">
							<div class="col-xs-12">
								<select data-width="100%" selectpicker="selectpicker" selectpicker-option="scenarioList" ng-options="c.scenarioId as c.scenarioName for c in scenarioList" ng-model="scenario" id="batchscenario" multiple="multiple">

								</select>
							</div>

						</div>
						<div class="row">
							<div class="col-xs-12">
								<p>&nbsp;</p>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-12">
								<p class="bold">Job name</p>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-12">
								<input value="" class="form-control" id="name" required="required" type="text" ng-model="batchName" />
							</div>
						</div>

						<div ng-if="filters.length > 0">
							<div class="row">
								<div class="col-xs-12">
									<p>&nbsp;</p>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-12">
									<p class="bold">Filters</p>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-12">
									<div class="table-responsive">
										<table class="table table-condensed table-bordered ">
											<thead>
												<tr>
													<td>Operator</td>
													<td class="col-xs-4">Field</td>
													<td>Expression</td>
													<td class="col-xs-4">Value</td>
													<td width="20">&nbsp;</td>
												</tr>
											</thead>
											<tbody>
												<tr ng-repeat="filter in filters">
													<td><select selectpicker="selectpicker" data-width="100%" ng-model="filter.operator" ng-if="$index > 0">
															<option value="AND">AND</option>
															<option value="OR">OR</option>

													</select></td>
													<td><select selectpicker="selectpicker" data-width="100%" ng-change="fieldSelect($index)" data-live-search="true" ng-model="filter.fieldName" selectpicker-option="fieldList" ng-options="field.name as field.label for field in fieldList | orderBy:'label'"></select></td>
													<td><select selectpicker="selectpicker" data-width="100%" ng-model="filter.expression">
															<option value="=">Equal</option>
															<option value="!=">Not Equal</option>
															<option value="<">Less then</option>
															<option value=">">Greater then</option>
															<option value="<=">Less then or Equal</option>
															<option value=">=">Greater then or Equal</option>
													</select></td>
													<td ng-switch="filter.fieldType"><select ng-switch-when="picklist" selectpicker="selectpicker" data-width="100%" ng-model="filter.fieldValue" selectpicker-option="filter.fieldName" ng-options="pick.value as pick.label for pick in filter.selectList| orderBy:'label'"></select> <select ng-switch-when="multipicklist" selectpicker="selectpicker" data-width="100%" ng-model="filter.fieldValue" selectpicker-option="filter.fieldName" ng-options="pick.value as pick.label for pick in filter.selectList| orderBy:'label'"></select>
														<div ng-switch-when="reference">
															<input class="form-control" typeahead-loading="loadingLocations" typeahead-wait-ms="500" typeahead-min-length="3" ng-model="filter.fieldValueLabel" typeahead-on-select="filter.fieldValue = $item.id" typeahead="related.name for related in getLookup($viewValue, filter.referenceTo)" type="text" /> <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i>
														</div> <select ng-switch-when="boolean" selectpicker="selectpicker" data-width="100%" ng-model="filter.fieldValue">
															<option value="true">True</option>
															<option value="false">False</option>
													</select> <input ng-switch-when="email" ng-model="filter.fieldValue" type="email" class="form-control" /> <input ng-switch-when="url" ng-model="filter.fieldValue" type="url" class="form-control" /> <input ng-switch-when="phone" ng-model="filter.fieldValue" type="phone" class="form-control" /> <input ng-switch-when="currency" ng-model="filter.fieldValue" type="number" step="any" class="form-control" /> <input ng-switch-when="double" ng-model="filter.fieldValue" type="number" step="any" class="form-control" /> <input ng-switch-when="integer" ng-model="filter.fieldValue" type="number" step="any" class="form-control" /> <input ng-switch-when="percent" ng-model="filter.fieldValue" type="number" step="any" class="form-control" /> <input ng-switch-default="ng-switch-default" ng-model="filter.fieldValue" type="text" ng-maxlength="filter.fieldLength" class="form-control" /></td>

													<td class="tools"><a class="s1utility s1utility-close text-danger" ng-click="deleteFilter($index)" /></td>
												</tr>

											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						
						<div ng-if="autoProcess.type == 'MERGE' && autoProcess.isMerge">
							<div class="row">
								<div class="col-xs-12">
									<p>&nbsp;</p>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-12">
									<p class="bold">Auto Merge</p>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-6">Threshold <span class="text-muted">- Merge all duplicates with a score equal or higher</span></div>
								<div class="col-xs-2 text-right">
									<span ng-bind-html="autoProcess.threshold"/>%
								</div>
								<div class="col-xs-4">
									<input slider="slider"  type="text" data-slider-min="1" data-slider-max="100" data-slider-step="1" tooltip="hide" value="{{autoProcess.threshold}}" ng-model="autoProcess.threshold"/>						
								</div>
							</div>
						</div>
						<div ng-if="autoProcess.type == 'CONVERT'" && autoProcess.isConvert">						
							<div class="row">
								<div class="col-xs-12">
									<p>&nbsp;</p>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-12">
									<p class="bold">Auto Convert</p>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-6">Threshold <span class="text-muted">- Convert all duplicates with a score equal or higher</span></div>
								<div class="col-xs-1 text-left">
									<span ng-bind-html="autoProcess.threshold"/>%
								</div>
								<div class="col-xs-5">
									<input slider="slider"  type="text" data-slider-min="1" data-slider-max="100" data-slider-step="1" tooltip="hide" value="{{autoProcess.threshold}}" ng-model="autoProcess.threshold"/>						
								</div>
							</div>
							
							<div class="row mg-t-5">
								<div class="col-xs-6">
									Convert Status
								</div>
								<div class="col-xs-6">
									<select selectpicker="selectpicker" id="convertStatus" ng-model="autoProcess.convertStatus" class="form-control">
										<apex:repeat value="{!convertStatus}" var="stat">
											<option data-content="{!JSINHTMLENCODE(stat.Label)}" value="{!stat.Value}">{!JSINHTMLENCODE(stat.Label)}</option>
										</apex:repeat>
									</select>
								</div>
							</div>
							
							<div class="row mg-t-5">
								<div class="col-xs-6">
									Owner for new records
								</div>
								<div class="col-xs-6">
									<select selectpicker="selectpicker" id="convertOwner" ng-model="autoProcess.convertOwner" class="form-control">
										<option data-content="Current {!$ObjectType.Lead.Label} Owner" value="LEAD">Current {!$ObjectType.Lead.Label} Owner</option>
										<option data-content="Current {!$ObjectType.Contact.Label} Owner" value="CONTACT">Current {!$ObjectType.Contact.Label} Owner</option>
										<option data-content="Current {!$ObjectType.Account.Label} Owner" value="ACCOUNT">Current {!$ObjectType.Account.Label} Owner</option>
										<option data-content="{!$User.FirstName} {!$User.LastName}" value="{!$User.Id}">{!$User.FirstName} {!$User.LastName}</option>
										<option data-content="Other: Specify.." value="OTHER">Other: Specify..</option>
									</select>
								</div>
							</div>
							<div class="row" ng-if="autoProcess.convertOwner=='OTHER'">
								<div class="col-xs-6">
									
								</div>
								<div class="col-xs-6">
									<input placeholder="type name.." class="form-control" typeahead-loading="loadingLocations" typeahead-wait-ms="500" typeahead-min-length="3" ng-model="autoProcess.convertOwnerName" typeahead-on-select="autoProcess.convertOwnerId = $item.id" typeahead="related.name for related in getLookup($viewValue, 'User')" type="text" /> <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i>
								</div>
							</div>
						</div>
						<div ng-if="schedule.isSchedule">
							<div class="row">
								<div class="col-xs-12">
									<p>&nbsp;</p>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-12">
									<p class="bold">Schedule</p>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-6">Frequency</div>
								<div class="col-xs-6">
									<select data-width="100%" selectpicker="selectpicker" ng-model="schedule.frequency">
										<option value="daily">Daily</option>
										<option value="weekly">Weekly</option>
										<option value="monthly">Monthly</option>
										<option value="custom">Custom</option>
									</select>
								</div>
							</div>
							<div class="row mg-t-5" ng-if="schedule.frequency == 'weekly'">
								<div class="col-xs-6">Recurs every week on</div>
								<div class="col-xs-6">
									<select data-width="100%" selectpicker="selectpicker" ng-model="schedule.weekday" multiple="multiple">
										<option value="1">Sunday</option>
										<option value="2">Monday</option>
										<option value="3">Tuesday</option>
										<option value="4">Wednesday</option>
										<option value="5">Thursday</option>
										<option value="6">Friday</option>
										<option value="7">Saturday</option>
									</select>
								</div>
							</div>
							<div class="row mg-t-5" ng-if="schedule.frequency == 'monthly'">
								<div class="col-xs-6">Recurs every month on the</div>
								<div class="col-xs-6">
									<select data-width="100%" selectpicker="selectpicker" ng-model="schedule.monthday">
										<option value="1">1st</option>
										<option value="2">2nd</option>
										<option value="3">3rd</option>
										<option value="4">4th</option>
										<option value="5">5th</option>
										<option value="6">6th</option>
										<option value="7">7th</option>
										<option value="8">8th</option>
										<option value="9">9th</option>
										<option value="10">10th</option>
										<option value="11">11th</option>
										<option value="12">12th</option>
										<option value="13">13th</option>
										<option value="14">14th</option>
										<option value="15">15th</option>
										<option value="16">16th</option>
										<option value="17">17th</option>
										<option value="18">18th</option>
										<option value="19">19th</option>
										<option value="20">20th</option>
										<option value="21">21th</option>
										<option value="22">22th</option>
										<option value="23">23th</option>
										<option value="24">24th</option>
										<option value="25">25th</option>
										<option value="26">26th</option>
										<option value="27">27th</option>
										<option value="28">28th</option>
										<option value="29">29th</option>
										<option value="30">30th</option>
										<option value="31">31th</option>
										<option value="L">last day</option>

									</select>
								</div>
							</div>
							<div class="row mg-t-5" ng-if="schedule.frequency != 'custom' && schedule.frequency">
								<div class="col-xs-6">Start Time (GMT)</div>
								<div class="col-xs-6">
									<select data-width="100%" selectpicker="selectpicker" ng-model="schedule.hour">
										<option value="0">12 AM (0:00)</option>
										<option value="1">1 AM (1:00)</option>
										<option value="2">2 AM (2:00)</option>
										<option value="3">3 AM (3:00)</option>
										<option value="4">4 AM (4:00)</option>
										<option value="5">5 AM (5:00)</option>
										<option value="6">6 AM (6:00)</option>
										<option value="7">7 AM (7:00)</option>
										<option value="8">8 AM (8:00)</option>
										<option value="9">9 AM (9:00)</option>
										<option value="10">10 AM (10:00)</option>
										<option value="11">11 AM (11:00)</option>
										<option value="12">12 PM (12:00)</option>
										<option value="13">1 PM (13:00)</option>
										<option value="14">2 PM (14:00)</option>
										<option value="15">3 PM (15:00)</option>
										<option value="16">4 PM (16:00)</option>
										<option value="17">5 PM (17:00)</option>
										<option value="18">6 PM (18:00)</option>
										<option value="19">7 PM (19:00)</option>
										<option value="20">8 PM (20:00)</option>
										<option value="21">9 PM (21:00)</option>
										<option value="22">10 PM (22:00)</option>
										<option value="23">11 PM (23:00)</option>

									</select>
								</div>
							</div>
							<div class="row mg-t-5" ng-if="schedule.frequency == 'custom'">
								<div class="col-xs-6">Cron String</div>
								<div class="col-xs-6">
									<input ng-model="schedule.cron" type="text" class="form-control" />
								</div>
							</div>
						</div>
        </div>
        <div class="modal-footer">
							<div class="col-xs-8 text-left">
								<button type="button" class="btn btn-success" ng-disabled="!sourceObject" ng-if="{!license.features.batchFilter}" ng-click="addFilter()">
									<i class="s1utility s1utility-filter" />&nbsp;Add Filter
								</button>
								<button type="button" class="btn btn-success" ng-if="{!license.features.batchSchedule} && !schedule.isSchedule" ng-click="addSchedule()">
									<i class="s1utility s1utility-event" />&nbsp;Add Schedule
								</button>
								<button type="button" class="btn btn-warning" ng-if="{!license.features.batchSchedule} && schedule.isSchedule" ng-click="removeSchedule()">
									<i class="s1utility s1utility-event" />&nbsp;Remove Schedule
								</button>
								<button type="button" class="btn btn-success" ng-if="{!license.features.batchSchedule} && {!license.features.batchMerge} && autoProcess.type == 'NONE' && autoProcess.isMerge" ng-click="autoProcess.type = 'MERGE'">
									<i class="s1utility s1utility-refresh" />Add Auto Merge
								</button>
								<button type="button" class="btn btn-warning" ng-if="{!license.features.batchSchedule} && {!license.features.batchMerge} && autoProcess.type == 'MERGE' && autoProcess.isMerge" ng-click="autoProcess.type = 'NONE'">
									<i class="s1utility s1utility-refresh" />Remove Auto Merge
								</button>
								<button type="button" class="btn btn-success" ng-if="{!license.features.batchSchedule} && {!license.features.batchConvert} && autoProcess.type == 'NONE' && autoProcess.isConvert" ng-click="autoProcess.type = 'CONVERT'">
									<i class="s1utility s1utility-refresh" />Add Auto Convert
								</button>
								<button type="button" class="btn btn-warning" ng-if="{!license.features.batchSchedule} && {!license.features.batchConvert} && autoProcess.type == 'CONVERT' && autoProcess.isConvert" ng-click="autoProcess.type = 'NONE'">
									<i class="s1utility s1utility-refresh" />Remove Auto Convert
								</button>
							</div>
							<div class="col-xs-4 text-right">
								<button type="button" class="btn btn-default" ng-click="cancel()">Close</button>
								<button type="button" class="btn btn-primary startBatch" ng-click="startBatch($event)" ng-hide="isStartBatch">Start</button>
								<button type="button" class="btn btn-primary startBatch " ng-show="isStartBatch" disabled="disabled">
									<i class="s1utility s1utility-spinner s1utility-animate"></i> One moment please
								</button>


							</div>
        </div>
    	</script>
		
		


	</div>
</apex:page>